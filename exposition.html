<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Visual Novel</title>
    <style>
        body {
            margin: 0;
            overflow-y: hidden;
            font-family: Arial, sans-serif;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        #scene {
            position: relative;
            height: 100vh;
            display: flex;
            flex-direction: row;
        }

        #background {
            background-image: url('background.jpg');
            z-index: 1;
        }

        #character {
            position: absolute;
            bottom: 10%;
            left: 50%;
            transition: transform 0.3s ease;
            z-index: 100;
        }

        #dialogue-container {
            position: absolute;
            bottom: 5%;
            left: 10%;
            right: 10%;
            display: flex;
            align-items: center;
            padding: 20px;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            border-radius: 10px;
            visibility: hidden;
            z-index: 100;
        }

        #dialogue {
            flex: 1;
            padding-left: 20px;
        }

        #speaker-image {
            width: 500px;
            height: 500px;
            border-radius: 50%;
            background-size: cover;
            background-position: center;
            position: absolute;
            bottom: 5%;
            left: 10%;
            z-index: 101;
            margin-left: -60px;
        }

        #static {
            top: 0;
            position: fixed;
            width: 100vw;
            height: 100vh;
            overflow: hidden;
        }

        .characters {
            position: relative;
            top: 0;
            width: 100vw;
            height: 100vh;
            overflow: hidden;
        }

        .grandmere,
        .fille {
            position: absolute;
            top: 0;
            width: 100vw;
            height: 100vh;
        }

        .grandmere img,
        .fille img {
            height: 100%;
        }

        .grandmere {
            z-index: 1;
        }

        .fille {
            z-index: 2;
        }

        .dialogue-box {
            display: flex;
        }
    </style>
</head>

<body>
    <div id="scene">
        <img src="background.jpg">
    </div>

    <div id="static">
        <div class="characters">
            <div class="grandmere">
                <img id="grandma-sprite" src="/persos/grandma/grandma.png" alt="Grandmother">
            </div>
            <div class="fille character">
                <img id="girl-sprite" src="/persos/girl/girl-1.png" alt="Girl">
            </div>
        </div>

        <div class="dialogue-box">
            <div id="speaker-image"></div>

            <div id="dialogue-container">
                <div id="dialogue"></div>
            </div>
        </div>

    </div>

    <script>
        const events = [
            {
                trigger: 5,
                action: () => startDialogue([
<<<<<<< HEAD
                    { speaker: "girl", text: "Quelque chose approche..." },
                    { speaker: "grandma", text: "Je ne sais pas ce que c'est..." },
                    { speaker: "girl", text: "Reste sur tes gardes !" }
                ])
            }
=======
                    "Petite-fille: Grandma, pourquoi tu as un tatouage sur ton front et moi non ? je veux en avoir un aussi",
                    "Grandma: Ah ma petite, tu es si attentive et si curieuse (RIRE), tu veux savoir pourquoi j’ai ce petit tatouage et toi non ? Mais non petite, toi tu ne peux pas te tatouer le front à cet âge là, tu es encore petite. Et je pense qu’il est temps de te raconter quelques trucs sur les traditions et les coutumes de la femme algérienne pour que tu saches ce qui est fait pour les grands et ce qui est fait pour les petits.",
                    "Petite-fille: oui grandma raconte moi je suis impressionnée de le savoir.",
                    "Grandma: Eh bien ma fleur, ouvre bien tes oreilles.",
                    "La narration de la grandma à la petite-fille: “ Dans les siècles précédents, le tatouage chez la femme algérienne était considéré comme un symbole d’appartenance à une tribu et il peut aussi indiquer une identité culturelle. Ce tatouage se gravait sur le front, les joues et le montant. Parfois on trouvait une femme avec un seul tatouage sur le front ou sur le montant et parfois on trouvait une femme qui mettait du tatouage sur ses quatre endroits cités à la fois. Les motifs changeaient selon le souhait de chaque femme. Une petite fille qui n’avait pas encore l'âge qui lui permettait de faire ce tatouage, n’en avait pas le droit. Ce n’est qu’à partir que la fille devient grande ou adulte ou alors elle se marie. Il était souvent utilisé pour que la femme soit belle. Aujourd’hui, cette tradition n’existe plus mais on voit les traces de ces tatouages chez certaines femmes algériennes âgées qui ont vécu à l’époque où le tatouage était permis.",
                    "Petite-fille: Ayyyy c’est génial ça! Je comprends maintenant pourquoi je ne peux pas mettre du tatouage sur mon visage (RIRE doux), car non seulement je suis petite mais aussi parce que cette tradition n’existe plus aujourd’hui car tout a changé.",
                    "Grandma: oui ma belle",
                    "Petite-fille: Mamie, tu as de très belles histoires apparemment (SOURIRE), je veux tout savoir sur la femme algérienne",
                    "Grandma: Ah tu veux tout savoir sur les traditions et les femmes algériennes ?",
                    "Petite-fille: oui s’il te plait, mamie, s’il te plait !",
                    "Grandma: suis-moi alors, je vais te montrer quelque chose que tu vas certainement aimer"
                ]) 
            },
            { 
                trigger: 1000, 
                action: () => changeCharacterSprite("character_angry.png") 
            },
            { 
                trigger: 1500, 
                action: () => playSound("suspense.mp3") 
            },
>>>>>>> ce534970189c91561d15f3d9432a101f0afbb12f
        ];

        let currentDialogueIndex = 0;

        function startDialogue(dialogues) {
            const dialogueBox = document.getElementById('dialogue');
            const speakerImage = document.getElementById('speaker-image');
            const dialogueContainer = document.getElementById('dialogue-container');

            showDialogue(dialogues[currentDialogueIndex]);

            dialogueBox.addEventListener('click', function nextDialogue() {
                currentDialogueIndex++;

                if (currentDialogueIndex < dialogues.length) {
                    showDialogue(dialogues[currentDialogueIndex]);
                } else {
                    dialogueContainer.style.visibility = 'hidden';
                    currentDialogueIndex = 0;
                    dialogueBox.removeEventListener('click', nextDialogue);
                }
            });

            function showDialogue(dialogue) {
                dialogueContainer.style.visibility = 'visible';
                typeText(dialogue.text);

                if (dialogue.speaker === 'girl') {
                    speakerImage.style.backgroundImage = "url('/persos/girl/girl-1.png')";
                } else if (dialogue.speaker === 'grandma') {
                    speakerImage.style.backgroundImage = "url('/persos/grandma/grandma.png')";
                }
            }

            function typeText(text) {
                let i = 0;
                dialogueBox.textContent = "";
                const typingInterval = setInterval(() => {
                    dialogueBox.textContent += text[i];
                    i++;
                    if (i >= text.length) {
                        clearInterval(typingInterval);
                    }
                }, 50);
            }
        }

        function preloadImages(frames) {
            frames.forEach(src => {
                const img = new Image();
                img.src = src;
            });
        }

        const girlFrames = [
            "/persos/girl/frame1.png",
            "/persos/girl/frame2.png",
            "/persos/girl/frame3.png",
            "/persos/girl/frame4.png",
        ];

        const grandmaFrames = [
            "/persos/grandma/frame1.png",
            "/persos/grandma/frame2.png",
        ];

        preloadImages(girlFrames);
        preloadImages(grandmaFrames);

        const girlSprite = document.getElementById("girl-sprite");
        const grandmaSprite = document.getElementById("grandma-sprite");

        const totalGirlFrames = girlFrames.length;
        const totalGrandmaFrames = grandmaFrames.length;

        let lastScrollPosition = 0;

        function updateAnimation() {
            const scrollPosition = window.scrollX;

            const direction = scrollPosition > lastScrollPosition ? 1 : -1;
            lastScrollPosition = scrollPosition;

            const girlFrameIndex = Math.floor((scrollPosition / window.innerWidth) * totalGirlFrames) % totalGirlFrames;
            const grandmaFrameIndex = Math.floor((scrollPosition / window.innerWidth) * totalGrandmaFrames) % totalGrandmaFrames;

            girlSprite.src = girlFrames[girlFrameIndex];
            grandmaSprite.src = grandmaFrames[grandmaFrameIndex];

            resetScrollStopTimer();
        }

        let scrollStopTimer;
        function resetScrollStopTimer() {
            clearTimeout(scrollStopTimer);
            scrollStopTimer = setTimeout(() => {
                girlSprite.src = "/persos/girl/girl-1.png";
                grandmaSprite.src = "/persos/grandma/grandma.png";
            }, 150);
        }

        window.addEventListener("scroll", () => {
            updateAnimation();
        });

        window.addEventListener('scroll', () => {
            const scrollPosition = window.scrollX;

            events.forEach(event => {
                if (!event.triggered && scrollPosition >= event.trigger) {
                    event.action();
                    event.triggered = true;
                }
            });
        });

    </script>

</body>

</html>